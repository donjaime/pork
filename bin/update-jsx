#!/usr/bin/env python2.7

import os
import shutil
import subprocess
import sys

def main():
  root = os.path.abspath(
    os.path.join(
      os.path.dirname(__file__),
      os.path.pardir))
  deps = os.path.join(root, 'deps')
  jsx = os.path.join(deps, 'jsx')

  if os.path.exists(jsx):
    shutil.rmtree(jsx)

  if subprocess.call([
      'git', 'clone', 'https://github.com/jsx/JSX.git', 'jsx'],
      cwd = deps) != 0:
    return 1

  if subprocess.call(['make'], cwd = jsx) != 0:
    return 1

  shutil.rmtree(os.path.join(jsx, '.git'))

  return 0

if __name__ == '__main__':
  sys.exit(main())